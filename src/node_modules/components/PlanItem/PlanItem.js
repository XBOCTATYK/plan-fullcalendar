import React, {Component} from 'react';
import './PlanItem.css';
import { observer } from 'mobx-react';
import { ResizableBox, Resizable } from 'react-resizable';
import Draggable from 'react-draggable';


class PlanItem extends Component {
    constructor(props) {
        super(props);

        this.element = React.createRef();
    }

    changeTime = (props, data) => {
        props.params.setTime(data);
    };

    dragStart = (event) => {
        this.props.drag.dragStart(this.props.id);
    };

    render() {
        return (
            <PlanItemO
                ref={this.element}
                dragStart={this.dragStart}
                changeTime={this.changeTime}
                {...this.props}/>
        );
    }
}

const PlanItemO = observer(props => {
    return (
        <Draggable
            scale={1}
            handle={".cursor"}
            position={!props.drag.drag ? {x: 0, y: 0} : null}
            height={props.params.time*2}
            onStart={(event) => {props.dragStart(event)}}
        >
            <div className={'drag-container box no-cursor'}>
        <ResizableBox
            className={`plan-item plan-item--${props.zone}`}
            width={'100%'} height={props.params.time*2}
            axis={'y'}
            draggableOpts={{
                grid: [30, 30]
            }}
            onResizeStop={(event, data) => {
                props.changeTime(props, (data.node.offsetTop + 10)/2);
            }}
            minConstraints={[30, 30]}
            maxConstraints={[900, 900]}>
            <div className={`plan-item__color plan-item__color--${props.priority}`}>!</div>
            <div className={'plan-item__body cursor'}>
                <div className={'plan-item__title-block'}>
                    <div className={'plan-item__project'}>{props.params.projectName}</div>
                    <div className={'plan-item__title'}>{props.params.name}</div>
                    <div className={'plan-item__time'}>{props.params.time}</div>
                </div>
            </div>
            <div className={'plan-item__control'}>
                <a className={`plan-item__link link`} href={`plan-item__link link`}/>
                <div className={'plan-item__checked-container'}>
                    <div className={'plan-item__checked'} style={{height: props.params.complete + '%'}}/>
                </div>
            </div>
        </ResizableBox>
            </div>
        </Draggable>

    );
});

export default PlanItem;

